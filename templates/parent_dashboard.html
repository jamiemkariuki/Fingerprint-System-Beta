{% extends 'base.html' %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Parent Dashboard</h2>
    <a href="{{ url_for('parent.parent_logout') }}" class="btn btn-secondary">Logout</a>
</div>

<div class="card">
    <h3>Welcome, {{ parent_info.name }}!</h3>
    <p><strong>Email:</strong> {{ parent_info.email }}</p>
    {% if parent_info.phone %}
    <p><strong>Phone:</strong> {{ parent_info.phone }}</p>
    {% endif %}
</div>

{% if children %}
<div class="card">
    <h3>Your Children</h3>
    {% for child in children %}
    <div class="card"
        style="margin-bottom: 20px; background: #f9f9f9; border-left: 4px solid {% if child.status == 'Present' %}green{% else %}orange{% endif %};">
        <h4>{{ child.name }} ({{ child.class }})</h4>
        <p><strong>Relationship:</strong> {{ child.relationship }}</p>
        <p>
            <strong>Today's Status:</strong>
            {% if child.status == 'Present' %}
            <span class="status-present">Present</span>
            {% else %}
            <span class="status-absent">Absent</span>
            {% endif %}
        </p>

        <h5>Attendance - Last 7 Days</h5>
        {% if child.recent_attendance %}
        <table style="margin-top: 10px;">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Scans</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for log in child.recent_attendance %}
                <tr>
                    <td>{{ log.date }}</td>
                    <td>{{ log.scan_count }}</td>
                    <td><span class="status-present">Present</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #777;">No attendance records in the last 7 days.</p>
        {% endif %}

        <div style="margin-top: 15px;">
            <a href="{{ url_for('teacher.student_attendance_pdf', student_id=child.id) }}" class="btn btn-small"
                target="_blank">Download Full Report (PDF)</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <p style="text-align: center; color: #777;">No children linked to your account yet. Please contact your school
        administrator.</p>
</div>
{% endif %}
{% endblock %}